<nz-layout class="main-page-layout">
    <nz-header class="main-page-header">
        <nz-breadcrumb>
            <nz-breadcrumb-item>
                <a href="#/home">首页</a>
            </nz-breadcrumb-item>
            <nz-breadcrumb-item>
                用户管理
            </nz-breadcrumb-item>
        </nz-breadcrumb>
    </nz-header>
    <nz-content class="main-page-content">
        <div class="tableListSearch">
            <!--表单-->
            <form nz-form>
                <!--行-->
                <div nz-row nz-form-item>
                    <!--列-->
                    <div nz-col [nzSpan]="6">
                        <div nz-form-label nz-col [nzSpan]="5">
                            <!--nz-form-item-required-->
                            <label>模糊查询</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="17">
                            <nz-input [nzType]="'text'" name="searchText" [(ngModel)]="paramCol.searchText" [nzPlaceHolder]="'编号/帐号/姓名/手机'" [nzSize]="'default'"></nz-input>
                        </div>
                    </div>
                    <div nz-col [nzSpan]="6">
                        <div nz-form-label nz-col [nzSpan]="5">
                            <label>用户状态</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="17">
                            <nz-select name="selectedOption" [(ngModel)]="paramCol.state" [nzPlaceHolder]="'请选择'" nzAllowClear>
                                <nz-option *ngFor="let option of userState" [nzLabel]="option.name" [nzValue]="option.id">
                                </nz-option>
                            </nz-select>
                        </div>
                    </div>
                    <div nz-col [nzSpan]="6">
                        <div nz-form-label nz-col [nzSpan]="5">
                            <label>组织/部门</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="17">
                            <nz-cascader name="dept" [nzPlaceHolder]="'请选择'" nzChangeOnSelect [nzExpandTrigger]="'click'" [nzValueProperty]="'org_id'"
                                [nzLabelProperty]="'org_name'" [nzOptions]="deptList" [(ngModel)]="paramCol.dept_id">
                            </nz-cascader>
                        </div>
                    </div>
                    <div nz-col [nzSpan]="6">
                        <div nz-form-label nz-col [nzSpan]="5">
                            <label>出生日期</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="19">
                            <nz-datepicker class="full" name="date" [nzPlaceHolder]="'请选择日期'" [(ngModel)]="paramCol.date" [nzPlaceHolder]="'Select date'"></nz-datepicker>
                        </div>
                    </div>
                </div>
                <div nz-row nz-form-item>
                    <div class="row-actions">
                        <button nz-button nzType="primary">
                            <i class="anticon anticon-plus"></i>
                            <span>新增</span>
                        </button>
                        <button nz-button nzType="primary">
                            <i class="anticon anticon-edit"></i>
                            <span>修改</span>
                        </button>
                        <button nz-button nzType="danger">
                            <span>批量删除</span>
                        </button>
                        <nz-dropdown>
                            <button nz-button nz-dropdown>
                                <span>更多操作</span>
                                <i class="anticon anticon-down"></i>
                            </button>
                            <ul nz-menu>
                                <li nz-menu-item>
                                    <a>批量审核</a>
                                </li>
                                <li nz-menu-item>
                                    <a>启用/停用</a>
                                </li>
                            </ul>
                        </nz-dropdown>
                    </div>
                    <div class="row-questions">
                            <button nz-button nzType="primary" (click)="reload(true)" [nzLoading]="_loading">
                                <i class="anticon anticon-search"></i>
                                <span>查询</span>
                            </button>
                            <button nz-button nzType="" (click)="resetForm()">
                                <span>重置</span>
                            </button>
                        </div>
                </div>
            </form>

            <nz-table #nzTable nzShowSizeChanger 
                [nzShowTotal]="true" 
                [nzAjaxData]="tableData" 
                [nzLoading]="_loading" 
                [nzPageSize]="param.pageSize"
                [nzPageIndex]="param.pageNum" 
                [nzTotal]="param.total" 
                (nzPageSizeChange)="reload(true)">
                <thead nz-thead>
                    <tr>
                        <th nz-th nzCheckbox>
                            <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
                            </label>
                        </th>
                        <th nz-th>
                            <span>头像</span>
                        </th>
                        <th nz-th>
                            <span>帐号</span>
                            <nz-table-sort [(nzValue)]="sortMap.user_name" (nzValueChange)="sort('user_name', $event)"></nz-table-sort>
                        </th>
                        <th nz-th>
                            <span>真实姓名</span>
                            <nz-table-sort [(nzValue)]="sortMap.user_real_name" (nzValueChange)="sort('user_real_name', $event)"></nz-table-sort>
                        </th>
                        <th nz-th>
                            <span>组织</span>
                        </th>
                        <th nz-th>
                            <span>角色</span>
                        </th>
                        <th nz-th>
                            <span>联系方式</span>
                        </th>
                        <th nz-th><span>状态</span></th>
                        <th nz-th><span>操作</span></th>
                    </tr>
                </thead>
                <tbody nz-tbody>
                    <tr nz-tbody-tr *ngFor="let data of nzTable.data">
                        <td nz-td nzCheckbox>
                            <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)"></label>
                        </td>
                        <td nz-td *ngIf="data.icon"><img class="uhead" src="{{service.ctxPath + data.icon}}"></td>
                        <td nz-td *ngIf="!data.icon"><span class="uhead">{{data.user_real_name.substr(0,1)}}</span></td>
                        <td nz-td>{{data.user_name}}</td>
                        <td nz-td>{{data.user_real_name}}</td>
                        <td nz-td *ngIf="data.dept_name">{{data.dept_name}}</td>
                        <td nz-td *ngIf="!data.dept_name">--</td>
                        <td nz-td>{{data.role_name}}</td>
                        <td nz-td *ngIf="data.phone">{{data.phone}}</td>
                        <td nz-td *ngIf="!data.phone">--</td>
                        <td nz-td><nz-switch [ngModel]="data.enabled == 1" [nzSize]="'small'" (click)="enabledUser(data)"></nz-switch></td>
                        <td nz-td>
                            <span>
                                <a href="#">修改</a>
                                <span nz-table-divider></span>
                                <a href="#">删除</a>
                                <span nz-table-divider></span>
                                <nz-dropdown>
                                    <a class="ant-dropdown-link" nz-dropdown>
                                        更多操作
                                        <i class="anticon anticon-down"></i>
                                    </a>
                                    <ul nz-menu>
                                        <li nz-menu-item>
                                            <a target="_blank" rel="noopener noreferrer" href="">1st menu item</a>
                                        </li>
                                        <li nz-menu-item>
                                            <a target="_blank" rel="noopener noreferrer" href="">2nd menu item</a>
                                        </li>
                                        <li nz-menu-item>
                                            <a target="_blank" rel="noopener noreferrer" href="">3rd menu item</a>
                                        </li>
                                    </ul>
                                </nz-dropdown>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </div>
    </nz-content>
</nz-layout>