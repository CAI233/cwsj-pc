<nz-layout class="main-page-layout">
  <nz-header class="main-page-header">
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a href="#/home">首页</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        短信模板
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </nz-header>
  <nz-content class="main-page-content" style="padding-top: 20px;">
    <form nz-form>
      <!--行-->

      <div nz-row nz-form-item>
        <div class="row-actions">
          <button nz-button nzType="primary" (click)="add()">
              <i class="anticon anticon-plus"></i>
              <span>新增</span>
          </button>
          <!-- <button nz-button nzType="primary" (click)="rev()">
            <i class="anticon anticon-edit"></i>
            <span>修改</span>
          </button> -->
          <nz-dropdown [nzTrigger]="'click'" [nzPlacement]="'bottomLeft'">
            <button nz-button nz-dropdown>云片一键新增</button>
            <ul nz-menu>
              <li nz-menu-item (click)="Yunadd(item.apikey)" *ngFor="let item of yun_data">{{item.apikey}}</li>
              
            </ul>
          </nz-dropdown>

        </div>

      </div>
    </form>


    <nz-table #nzTable [nzDataSource]="data"  (nzDataChange)="_displayDataChange($event)" nzShowSizeChanger [nzShowTotal]="true" [nzAjaxData]="data" [nzLoading]="_loading" [nzPageSize]="param.pageSize"
    [nzPageIndex]="param.pageNum" [nzTotal]="param.total" (nzPageIndexChangeClick)="param.pageNum=$event;load($event)"
    (nzPageSizeChange)="param.pageNum=1;param.pageSize=$event;load($event)">
      <thead nz-thead>
      <tr>
        <th nz-th nzCheckbox>
          <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
          </label>
        </th>
        <th nz-th [nzWidth]="'15%'"><span>模板编码</span></th>
        <th nz-th [nzWidth]="'50%'"><span>模板内容</span></th>
        <th nz-th [nzWidth]="'15%'"><span>所属平台</span></th>
        <th nz-th><span>操作</span></th>
      </tr>
      </thead>
      <tbody nz-tbody>
      <tr nz-tbody-tr *ngFor="let data of nzTable.data">
        <td nz-td nzCheckbox>
          <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)">
          </label>
        </td>
        <td nz-td>
            <span *ngIf="editRow!=data.id">{{data.tpl_id}}</span>
            <span *ngIf="editRow==data.id">
              <nz-input [(ngModel)]="data.tpl_id" style="width:100%;"></nz-input>
            </span>
        </td>
        <td nz-td>
            <span *ngIf="editRow!=data.id">{{data.tpl_content}}</span>
            <span *ngIf="editRow==data.id">
              <nz-input [(ngModel)]="data.tpl_content" style="width:100%;"></nz-input>
            </span>
        </td>
        <td nz-td>
            <span [innerHtml]="data.flag==1 ? '云片' : '阿里'"></span>
        </td>
        <td nz-td>
          <span *ngIf="editRow!=data.id">
            <a (click)="edit(data)">修改</a>
          </span>
          <span *ngIf="editRow==data.id">
            <a (click)="save(data)">保存</a>
            <span nz-table-divider></span>
              <nz-popconfirm [nzTitle]="'确定取消吗?'" (nzOnConfirm)="cancel(data)">
                <a nz-popconfirm>取消</a>
              </nz-popconfirm>
          </span>
          <span *ngIf="editRow!=data.id">
              <nz-popconfirm [nzTitle]="'确定取消吗?'" (nzOnConfirm)="del(data)">
                <a nz-popconfirm>删除</a>
              </nz-popconfirm>
          </span>
        </td>
      </tr>
      </tbody>
    </nz-table>
  </nz-content>
</nz-layout>

<nz-modal [nzMaskClosable]="false" [nzWidth]="500" [nzWrapClassName]="'vertical-center-modal'" [nzContent]="modalContent"
  [nzVisible]="isVisibleMiddle" [nzTitle]="formTitle" (nzOnCancel)="handleCancelMiddle($event)" (nzOnOk)="handleOkMiddle($event)">
  <ng-template #modalContent>

    <form nz-form [formGroup]="myForm" (ngSubmit)="_submitForm()">
      <div nz-form-item nz-row class="notErrMsg">
        <div nz-form-label>
          <label nz-form-item-required>模板内容</label>
        </div>
        <div nz-form-control>
          <nz-input formControlName="num"  [nzType]="'text'" [(ngModel)]="param.tpl_id" [nzPlaceHolder]="'请填写模板编码'"></nz-input>
        </div>
      </div>
      <div nz-form-item nz-row class="notErrMsg">
        <div nz-form-label>
          <label nz-form-item-required>模板内容</label>
        </div>
        <div nz-form-control>
          <nz-input formControlName="test"  [nzType]="'text'" [(ngModel)]="param.tpl_content" [nzPlaceHolder]="'请填写模板名称'"></nz-input>
        </div>
      </div>
      <button style="display:none;">save</button>
    </form>

  </ng-template>
</nz-modal>