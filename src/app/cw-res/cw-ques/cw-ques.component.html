<nz-layout class="main-page-layout">
    <nz-header class="main-page-header">
      <nz-breadcrumb>
        <nz-breadcrumb-item>
          <a href="#/home">首页</a>
        </nz-breadcrumb-item>
        <nz-breadcrumb-item>
          试题管理
        </nz-breadcrumb-item>
      </nz-breadcrumb>
    </nz-header>
    <nz-content class="main-page-content">
      <div class="ListSearch">
        <form nz-form>
          <div nz-row nz-form-item>
            <div class="row-actions">
              <button nz-button nzType="primary" type="button" (click)="_addRows()" >
                <i class="anticon anticon-plus" style="font-size:12px;color:#fff;"></i>
                <span>新增</span>
              </button>
              <!-- <nz-popconfirm [nzTitle]="'删除后数据无法找回,确认删除吗？'" (nzOnConfirm)="delRows()" [nzPlacement]="'bottom'">
                <button nz-popconfirm nz-button nzType="danger" type="button" >
                  <i class="anticon anticon-delete"></i>
                  <span>删除</span>
                </button>
              </nz-popconfirm> -->
            </div>
            <div class="row-questions">
              <nz-input [nzType]="'search'" [nzPlaceHolder]="'模糊搜索'" name="searchText" [(ngModel)]="param.searchText" style="width: 200px;"
                (nzOnSearch)="reload(true)"></nz-input>
            </div>
          </div>
        </form>
      </div>
      <nz-table #nzTable  nzShowSizeChanger [nzShowTotal]="true" [nzAjaxData]="data" [nzLoading]="_loading" [nzPageSize]="param.pageSize"
      [nzPageIndex]="param.pageNum" [nzTotal]="param.total" (nzPageIndexChangeClick)="param.pageNum=$event;load($event)"
      (nzPageSizeChange)="param.pageNum=1;param.pageSize=$event;load($event)">
        <thead nz-thead>
        <tr>
          <th nz-th nzCheckbox>
            <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
            </label>
          </th>
          <th nz-th [nzWidth]="'15%'"><span>题目类型</span></th>
          <!-- <th nz-th [nzWidth]="'20%'"><span>题目内容</span></th> -->
          <th nz-th [nzWidth]="'15%'"><span>题目标签</span></th>
          <th nz-th [nzWidth]="'15%'"><span>参考分值</span></th>
          <th nz-th [nzWidth]="'15%'"><span>使用次数</span></th>
          <th nz-th [nzWidth]="'15%'"><span>发布状态</span></th>
          <th nz-th><span>操作</span></th>
        </tr>
        </thead>
        <tbody nz-tbody>
        <tr nz-tbody-tr *ngFor="let data of nzTable.data">
          <td nz-td nzCheckbox>
            <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)">
            </label>
          </td>
          <td nz-td>
              <span >{{['单选题','多选题','判断题'][data.type]}}</span>
          </td>
          <td nz-td>
              <span [innerHtml]="data.tag_names"></span>
          </td>
          <td nz-td>
              <span>{{data.score}}</span>
          </td>
          <td nz-td>
              <span>{{data.number}}</span>
          </td>
          <td nz-td>
              <span>{{['待审核','审核未通过','审核通过'][data.audit_status-2]}}</span>
          </td>
          <td>
            <a (click)="_addRows()">审核</a>
            <span nz-table-divider></span>
            <a (click)="_seeRows()">预览</a>
            <span nz-table-divider></span>
            <a (click)="_updateRows()">修改</a>
            <span nz-table-divider></span>
            <nz-popconfirm [nzTitle]="'确定要删除这个试题吗？'" (nzOnConfirm)="_delRows(item)" [nzPlacement]="'left'">
                <a nz-popconfirm >删除</a>
            </nz-popconfirm>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-content>
  </nz-layout>
  <nz-modal [nzMaskClosable]="false" [nzWidth]="800" [nzWrapClassName]="'vertical-center-modal'" [nzContent]="modalContent"
    [nzVisible]="isList" (nzOnCancel)="handleCancelMiddle($event)" (nzOnOk)="handleOkMiddle($event)" [nzTitle]="formTitle">
    <ng-template #modalContent>
      <form nz-form [formGroup]="myForm" (ngSubmit)="_submitForm()" class="ditForm">
        <div nz-form-item nz-row>
          <div nz-col [nzSpan]="12" style="padding-right:10px;">
              <div nz-form-label>
                <label nz-form-item-required>题目类型</label>
              </div>
              <div nz-form-control>
                <div class="row-actions" style="width:100%">
                  <nz-select style="width:100%;" formControlName="type" [(ngModel)]="param.type" [nzPlaceHolder]="'请选择题目类型'" nzShowSearch>
                    <nz-option *ngFor="let item of typeData" [nzLabel]="item.type_name" [nzValue]="item.id" ></nz-option>
                  </nz-select>
                </div>
              </div>
          </div>
          <div nz-col [nzSpan]="12" style="padding-left:10px;">
              <div nz-form-label>
                <label nz-form-item-required>题目标签</label>
              </div>
              <div nz-form-control>
                <div class="row-actions" style="width:100%">
                  <nz-select style="width:100%;" formControlName="type" [(ngModel)]="param.type" [nzPlaceHolder]="'请选择题目类型'" nzShowSearch>
                    <nz-option *ngFor="let item of typeData" [nzLabel]="item.type_name" [nzValue]="item.id" ></nz-option>
                  </nz-select>
                </div>
              </div>
          </div>
        </div>
        <div nz-form-item nz-row>
          <div nz-col [nzSpan]="12" style="padding-right:10px;">
              <div nz-form-label>
                  <label nz-form-item-required>参考分值</label>
              </div>
              <div nz-form-control>
                  <nz-input formControlName="score" [nzType]="'number'" [(ngModel)]="param.score" [nzPlaceHolder]="'请填写参考分值'"></nz-input>
              </div>
          </div>
          <div nz-col [nzSpan]="12" style="padding-left:10px;">
              <div nz-form-label>
                  <label nz-form-item-required>分类</label>
              </div>
              <div nz-form-control>
                  <nz-input formControlName="score" [nzType]="'number'" [(ngModel)]="param.score" [nzPlaceHolder]="'请填写参考分值'"></nz-input>
              </div>
          </div>
        </div>
        <div>
          <div nz-col [nzSpan]="24">
            <div nz-form-label>
                <label nz-form-item-required>模板内容</label>
              </div>
              <div nz-form-control>
                <ckeditor [config]="config" [(ngModel)]="param.content" formControlName="content" [readonly]="false" debounce="500"></ckeditor>
              </div>
          </div>
        </div>
        <button style="display:none;">save</button>
      </form>
    </ng-template>
  </nz-modal>
  