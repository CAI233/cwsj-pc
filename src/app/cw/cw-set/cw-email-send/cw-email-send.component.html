<nz-layout class="main-page-layout">
  <nz-header class="main-page-header">
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a href="#/home">首页</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        邮件发送
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </nz-header>
  <nz-content class="main-page-content" style="padding-top: 20px;">
    <form nz-form>
      <div nz-row nz-form-item style="margin-bottom:10px;">
          <div nz-col [nzSpan]="6">
              <div nz-form-label nz-col style="float:left;">
                  <label>邮件标题</label>
              </div>
              <div nz-form-control nz-col [nzSpan]="14">
                  <nz-input [nzType]="'text'" name="searchText" [(ngModel)]="param.searchText" [nzPlaceHolder]="'请输入邮件标题'" [nzSize]="'default'"></nz-input>
              </div>
          </div>
          <div nz-col [nzSpan]="6" style="padding:2px 0;">
              <div class="row-questions" style="float:left;">
                  <button nz-button nzType="primary" (click)="reload(true)">
                      <i class="anticon anticon-search"></i>
                      <span>查询</span>
                  </button>
                  <button nz-button nzType="" (click)="resetForm()">
                      <span>重置</span>
                  </button>
              </div>
          </div>
      </div>
      <div nz-row nz-form-item style="margin-bottom:10px;">
        <div class="row-actions">
          <!-- *ngIf="this.service.validataAction('cw_goods_list_add')" -->
          <button nz-button nzType="primary" type="button" (click)="add()" >
              <i class="anticon anticon-plus" style="font-size:12px;color:#fff;"></i>
              <span>新增</span>
          </button>
          <nz-popconfirm [nzTitle]="'删除后数据无法找回,确认删除吗？'" (nzOnConfirm)="delRows()" [nzPlacement]="'bottom'" >
              <button nz-popconfirm nz-button nzType="danger" type="button" >
                  <i class="anticon anticon-delete"></i>
                  <span>删除</span>
              </button>
          </nz-popconfirm>  
        </div>
      </div> 
    </form>
      <nz-table #nzTable  nzShowSizeChanger [nzShowTotal]="true" [nzAjaxData]="data" [nzLoading]="_loading" [nzPageSize]="param.pageSize"
      [nzPageIndex]="param.pageNum" [nzTotal]="param.total" (nzPageIndexChangeClick)="param.pageNum=$event;load($event)"
      (nzPageSizeChange)="param.pageNum=1;param.pageSize=$event;load($event)">
        <thead nz-thead>
        <tr>
          <th nz-th nzCheckbox>
            <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
            </label>
          </th>
          <th nz-th >
              <span>邮件标题</span>
          </th>
          <th nz-th >
              <span>发送时间</span>
          </th>
          <th nz-th >
              <span>操作</span>
          </th>
        </tr>
        </thead>
        <tbody nz-tbody>
          <tr nz-tbody-tr *ngFor="let data of nzTable.data">
            <td nz-td nzCheckbox>
              <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)">
              </label>
            </td>
            <td nz-td >
              <span>{{data.mail_title}}</span>
            </td>
            <td nz-td>
                <span>{{data.creator_time}}</span>
            </td>
            <td nz-td>
                <span >
                  <a (click)="send(data)">发送</a>
                  <span nz-table-divider></span>
                </span>
              <span >
                <a (click)="edit(data)">修改</a>
                <span nz-table-divider></span>
              </span>
              <span >
                <a (click)="show(data)">查看</a>
                <span nz-table-divider></span>
              </span>
              <span >
                  <nz-popconfirm [nzTitle]="'确定取消吗?'" (nzOnConfirm)="del(data)">
                    <a nz-popconfirm>删除</a>
                  </nz-popconfirm>
              </span>
            </td>
          </tr>
        </tbody>
    </nz-table>
  </nz-content>
</nz-layout>
<nz-modal [nzVisible]="isCheck" [nzWidth]="800" [nzTitle]="isTitle" [nzContent]="Content" (nzOnCancel)="_Cancel($event)" (nzOnOk)="_Ok($event)">
    <ng-template #Content>
        <form nz-form [formGroup]="myForm" class="ditForm">
            <div nz-row nz-form-item style="margin-bottom:10px;">
              <div nz-col [nzSpan]="12">
                  <div nz-form-label nz-col style="float:left;">
                      <label>邮件标题</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="14">
                      <nz-input [nzType]="'text'" formControlName="mail_title" [(ngModel)]="selRow.mail_title" [nzPlaceHolder]="'请输入邮件标题'" [nzSize]="'default'"></nz-input>
                  </div>
              </div>
              <div nz-col [nzSpan]="12">
                  <div nz-form-label nz-col style="float:left;">
                      <label>模板选择</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="14">
                      <nz-select style="width:100%;" formControlName="mail_template_id" [nzAllowClear]="false" [nzPlaceHolder]="'请选择'" [(ngModel)]="selRow.mail_template_id" (ngModelChange)="select()">
                          <nz-option *ngFor="let item of mail_template" [nzLabel]="item.mail_template_id" [nzValue]="item.mail_template_id"></nz-option>
                      </nz-select>
                  </div>
              </div>
            </div>
            <div nz-row nz-form-item style="margin-bottom:10px;">
                <div nz-form-label nz-col style="float:left;">
                    <label>模板内容</label>
                </div>
                <div nz-form-control nz-col style="float:left;width:calc(100% - 65px);">
                    <div id="editor"></div>
                </div>
            </div>
            <button style="display:none;">save</button>
        </form>
    </ng-template>
</nz-modal>
<nz-modal [nzVisible]="isShow" [nzWidth]="800" [nzTitle]="isTitle" [nzFooter]="false" [nzContent]="showContent" (nzOnCancel)="_Cancel($event)" >
    <ng-template #showContent>
        <div nz-row nz-form-item style="margin-bottom:10px;">
            <div nz-form-label nz-col style="float:left;">
                <label>邮件标题</label>
            </div>
            <div nz-form-control nz-col [nzSpan]="14">
                <!-- <nz-input [nzType]="'text'" formControlName="mail_title" [(ngModel)]="selRow.mail_title" [nzPlaceHolder]="'请输入邮件标题'" [nzSize]="'default'"></nz-input> -->
                <span>{{showSelRow.mail_title}}</span>
            </div>
        </div>
        <div nz-row nz-form-item style="margin-bottom:10px;">
          <div nz-form-label nz-col style="float:left;">
              <label>邮件内容</label>
          </div>
          <div nz-form-control nz-col style="float:left;width:calc(100% - 65px);border: 1px solid #ccc;padding:15px;">
              <span  [innerHTML]="showSelRow.mail_content"></span>
          </div>
        </div>
    </ng-template>
</nz-modal>