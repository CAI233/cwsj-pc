<nz-layout class="main-page-layout">
  <nz-header class="main-page-header">
    <nz-breadcrumb>
      <nz-breadcrumb-item>
        <a href="#/home">首页</a>
      </nz-breadcrumb-item>
      <nz-breadcrumb-item>
        活动列表
      </nz-breadcrumb-item>
    </nz-breadcrumb>
  </nz-header>
  <nz-content class="main-page-content">
    <div class="tableListSearch">
      <!--表单-->
      <form nz-form>
        <!--行-->

        <div nz-row nz-form-item>
          <div class="row-actions">
            <button nz-button nzType="primary" (click)="showModalMiddle()" *ngIf="this.service.validataAction('activity_add')">
              <i class="anticon anticon-plus"></i>
              <span>新增</span>
            </button>
            <button nz-button nzType="primary" (click)="editModalMiddle()" *ngIf="this.service.validataAction('activity_update')">
              <i class="anticon anticon-edit"></i>
              <span>修改</span>
            </button>
            <nz-popconfirm [nzTitle]="'删除后数据无法找回,确认删除吗？'" (nzOnConfirm)="delRows()" [nzPlacement]="'bottom'" *ngIf="this.service.validataAction('activity_del')">
              <button nz-popconfirm nz-button nzType="danger">
                <i class="anticon anticon-delete"></i>
                <span>删除</span>
              </button>
            </nz-popconfirm>

          </div>
          <div class="row-questions">
            <nz-input [nzType]="'search'" [nzPlaceHolder]="'活动标题'" name="searchText" [(ngModel)]="param.searchText" style="width: 200px;"
              (nzOnSearch)="reload(true)"></nz-input>
          </div>
        </div>
      </form>
      <nz-table #nzTable nzShowSizeChanger [nzShowTotal]="true" [nzAjaxData]="tableData" [nzLoading]="_loading" [nzPageSize]="param.pageSize"
        [nzPageIndex]="param.pageNum" [nzTotal]="param.total" (nzPageIndexChangeClick)="param.pageNum=$event;reload($event)"
        (nzPageSizeChange)="param.pageNum=1;param.pageSize=$event;reload($event)">
        <thead nz-thead>
          <tr>
            <th nz-th nzCheckbox>
              <label nz-checkbox [(ngModel)]="_allChecked" [nzIndeterminate]="_indeterminate" (ngModelChange)="_checkAll($event)">
              </label>
            </th>
            <th nz-th>
              <span>活动ID</span>
            </th>
            <th nz-th>
              <span>活动标题</span>
            </th>
            <th nz-th>
              <span>开始时间</span>
            </th>
            <th nz-th>
              <span>结束时间</span>
            </th>
            <th nz-th>
              <span>报名状态</span>
            </th>
            <th nz-th>
              <span>操作</span>
            </th>
          </tr>
        </thead>
        <tbody nz-tbody>
          <tr nz-tbody-tr *ngFor="let data of nzTable.data">
            <td nz-td nzCheckbox>
              <label nz-checkbox [(ngModel)]="data.checked" (ngModelChange)="_refreshStatus($event)"></label>
            </td>
            <td nz-td>
              <span>{{data.vote_id}}</span>
            </td>
            <td nz-td>
              <span>{{data.vote_name}}</span>
            </td>
            <td nz-td>
              <span>{{data.begin_time}}</span>
            </td>
            <td nz-td>
              <span>{{data.end_time}}</span>
            </td>
            <td nz-td>
              <span style="letter-spacing: 1px;">
                总数({{data.all_count}}) &ngsp; | &ngsp; <em style="color:red">未审核</em>({{data.disable_count}})
              </span>
            </td>
            <td nz-td>
              <span>
                <a href="javascript:void(0)" (click)="routerJump(data.vote_id)">选手列表</a>
                <span nz-table-divider></span>
                <a href="javascript:void(0)" (click)="showModalMiddle(data)" *ngIf="this.service.validataAction('activity_update')">编辑</a>
                <span nz-table-divider *ngIf="this.service.validataAction('activity_update')"></span>
                <nz-popconfirm [nzTitle]="'确定要删除这条信息吗？'" (nzOnConfirm)="_delete(data.vote_id)" [nzPlacement]="'left'" *ngIf="this.service.validataAction('activity_del')">
                  <a nz-popconfirm>删除</a>
                </nz-popconfirm>
              </span>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-content>
</nz-layout>


<nz-modal [nzMaskClosable]="false" [nzWidth]="800" [nzWrapClassName]="'vertical-center-modal'" [nzContent]="modalContent"
  [nzVisible]="formBean.isVisibleMiddle" [nzTitle]="formBean.formTitle" (nzOnCancel)="handleCancelMiddle($event)" (nzOnOk)="handleOkMiddle($event)">
  <ng-template #modalContent>

    <form nz-form [formGroup]="myForm" (ngSubmit)="_submitForm()">
      <div nz-form-item nz-row style="margin-bottom:0;">

        <div nz-col [nzSpan]="12">
          <div class="userHead">
            <div class="uimg">
              <img *ngIf="formBean.vote_img" src="{{ service.ctxPath + formBean.vote_img }}" />
            </div>
            <nz-upload [nzShowUploadList]="false" (nzChange)="fileUpload($event)" [nzAccept]="'image/gif,image/jpeg,image/png,image/jpg,image/bmp'"
              nzAction="{{service.ctxPath + '/api/system/file/upload'}}" [nzData]="{type:'admin',token:service.token}">
              <button nz-button type="button">
                <i class="anticon anticon-upload"></i>
                <span>上传封面</span>
              </button>
            </nz-upload>
          </div>
        </div>
        <div nz-col [nzSpan]="12">
          <div nz-form-item nz-row>
            <div nz-form-label>
              <label nz-form-item-required>活动标题</label>
            </div>
            <div nz-form-control nzHasFeedback>
              <nz-input formControlName="vote_name" [(ngModel)]="formBean.vote_name" [nzPlaceHolder]="'请输入活动标题'"></nz-input>
            </div>
          </div>
          <div nz-form-item nz-row>
            <div nz-form-label>
              <label nz-form-item-required>开始时间</label>
            </div>
            <div nz-form-control nzHasFeedback>
                <nz-datepicker style="width:100%"  formControlName="begin_time" [(ngModel)]="formBean.begin_time" nzShowTime [nzPlaceHolder]="'请选择开始时间'" [nzFormat]="'YYYY-MM-DD HH:mm:ss'"></nz-datepicker>
            </div>
          </div>
          <div nz-form-item nz-row>
            <div nz-form-label>
              <label nz-form-item-required>结束时间</label>
            </div>
            <div nz-form-control nzHasFeedback>
                <nz-datepicker  style="width:100%"  formControlName="end_time" [(ngModel)]="formBean.end_time" nzShowTime [nzPlaceHolder]="'请选择结束时间'" [nzFormat]="'YYYY-MM-DD HH:mm:ss'"></nz-datepicker>
            </div>
          </div>
        </div>
      </div>
      <div nz-form-item nz-row>
        <div nz-form-label>
          <label nz-form-item-required>活动简介</label>
        </div>
        <div nz-form-control nzHasFeedback>
          <nz-input [nzType]="'textarea'" [nzAutosize]="{ minRows: 4, maxRows: 10 }" formControlName="vote_remark" [(ngModel)]="formBean.vote_remark "></nz-input>
        </div>
      </div>
      <div nz-form-item nz-row>
        <div nz-form-label>
          <label nz-form-item-required>活动规则</label>
        </div>
        <div nz-form-control>
          <ckeditor [config]="config" [(ngModel)]="formBean.vote_role" formControlName="vote_role" [readonly]="false" debounce="500"></ckeditor>
          <!-- (change)="onChange($event)"  -->
          <!-- (editorChange)="onEditorChange($event)" -->
          <!-- (ready)="onReady($event)"  -->
          <!-- (focus)="onFocus($event)"  -->
          <!-- (blur)="onBlur($event)"  -->
          <!-- (contentDom)="onContentDom($event)"  -->
          <!-- (fileUploadRequest)="onFileUploadRequest($event)" -->
        </div>
      </div>
      <button style="display:none;">save</button>
    </form>

  </ng-template>
</nz-modal>